<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טעינת קבצים והצגת נתונים</title>
    <script>
        function loadFiles() {
            const dataFile = document.getElementById("dataFile").files[0];
            const workersFile = document.getElementById("workersFile").files[0];
            const clocksFile = document.getElementById("clocksFile").files[0];
            
            if (!dataFile || !workersFile || !clocksFile) {
                alert("נא להעלות את כל שלושת הקבצים");
                return;
            }

            const readerData = new FileReader();
            const readerWorkers = new FileReader();
            const readerClocks = new FileReader();
            
            let workersMap = {};
            let clocksMap = {};
            
            readerWorkers.onload = function(event) {
                const lines = event.target.result.split('\n');
                lines.forEach(line => {
                    let [id, name] = line.trim().split(',');
                    if (id && name) workersMap[id] = name;
                });
            };
            readerClocks.onload = function(event) {
                const lines = event.target.result.split('\n');
                lines.forEach(line => {
                    let [id, name] = line.trim().split(',');
                    if (id && name) clocksMap[id] = name;
                });
            };
            
            readerData.onload = function(event) {
                const lines = event.target.result.split('\n');
                let tableBody = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
                tableBody.innerHTML = "";
                
                lines.forEach(line => {
                    line = line.trim();
                    if (line.length === 25) {
                        let clockId = line.substring(0, 3);
                        let entryType = line.substring(3, 4) === "1" ? "כניסה" : "יציאה";
                        let date = line.substring(6, 12);
                        let time = line.substring(12, 16);
                        let workerId = line.substring(16, 25);
                        
                        let clockName = clocksMap[clockId] || clockId;
                        let workerName = workersMap[workerId] || workerId;
                        
                        let row = `<tr>
                            <td>${clockName}</td>
                            <td>${entryType}</td>
                            <td>${date}</td>
                            <td>${time}</td>
                            <td>${workerName}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    }
                });
            };
            
            readerWorkers.readAsText(workersFile);
            readerClocks.readAsText(clocksFile);
            readerData.readAsText(dataFile);
        }
    </script>
</head>
<body>
    <h2>העלה קבצים</h2>
    <input type="file" id="dataFile" accept=".txt,.dat"><br>
    <input type="file" id="workersFile" accept=".txt"><br>
    <input type="file" id="clocksFile" accept=".txt"><br>
    <button onclick="loadFiles()">טען נתונים</button>

    <h2>נתונים</h2>
    <table border="1" id="dataTable">
        <thead>
            <tr>
                <th>שעון</th>
                <th>סוג</th>
                <th>תאריך</th>
                <th>שעה</th>
                <th>עובד</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</body>
</html>
