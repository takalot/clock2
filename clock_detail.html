<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>רשימת שעונים</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
</head>
<body style="direction: rtl; font-family: sans-serif;">

  <h2>ניהול רשימת שעונים</h2>
  <table id="clocksTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>#</th>
        <th>מיקום</th>
        <th>מספר שעון</th>
        <th>IP</th>
        <th>כתובת</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Iframe caché qui chargera les données sans CORS -->
  <iframe id="data-frame" src="https://script.google.com/macros/s/AKfycbzsQzXefgunW_9YP-V04cjiAqxm_1FSKGUZBepmIjhv4ivg9olZfsMOWfhD-xPsRXl_3Q/exec" style="display:none;"></iframe>

  <script>
    window.addEventListener("message", function(event) {
      const data = event.data;

      if (!Array.isArray(data)) return;

      const table = $('#clocksTable').DataTable();
      data.forEach(item => {
        table.row.add([
          item.index,
          item.location,
          item.clockId,
          item.ipAddress,
          item.address
        ]);
      });
      table.draw();
    });

    $(document).ready(function () {
      $('#clocksTable').DataTable();
    });
  </script>
</body>
</html>
